# ìŠˆë„ì½”ë“œ ì£¼ë„ ê°œë°œ (Pseudocode-Driven Development) ë¬¸ì„œ

## ðŸ“‹ ê°œìš”

ì´ ë¬¸ì„œë“¤ì€ **ì½”ë“œë¥¼ ìž‘ì„±í•˜ê¸° ì „ì— ì™„ì „í•œ êµ¬í˜„ ëª…ì„¸ë¥¼ ìžì—°ì–´ì™€ ìŠˆë„ì½”ë“œë¡œ ìž‘ì„±**í•˜ëŠ” ë°©ì‹ìž…ë‹ˆë‹¤.

### ê¸°ì¡´ ë¬¸ì„œ vs ìŠˆë„ì½”ë“œ ì£¼ë„ ë¬¸ì„œ

| í•­ëª© | ê¸°ì¡´ ë¬¸ì„œ | ìŠˆë„ì½”ë“œ ì£¼ë„ ë¬¸ì„œ |
|------|-----------|-------------------|
| **ìƒì„¸ë„** | ì¶”ìƒì  ì„¤ëª… | ë¼ì¸ ë°”ì´ ë¼ì¸ êµ¬í˜„ |
| **ì½”ë“œ ì˜ˆì‹œ** | ê°„ë‹¨í•œ ìŠ¤ë‹ˆíŽ« | ì™„ì „í•œ í•¨ìˆ˜/í´ëž˜ìŠ¤ |
| **ë³€ìˆ˜ëª…** | ì˜ˆì‹œ ìˆ˜ì¤€ | ì‹¤ì œ ì‚¬ìš©í•  ì´ë¦„ |
| **ì—ëŸ¬ ì²˜ë¦¬** | ê°œë…ì  ì„¤ëª… | ëª¨ë“  ì¼€ì´ìŠ¤ ëª…ì‹œ |
| **í…ŒìŠ¤íŠ¸** | ì¼ë°˜ì  ì„¤ëª… | êµ¬ì²´ì  ì‹œë‚˜ë¦¬ì˜¤ |
| **ì¦‰ì‹œ ì½”ë”© ê°€ëŠ¥** | âŒ | âœ… |

---

## ðŸŽ¯ ìŠˆë„ì½”ë“œ ì£¼ë„ ë¬¸ì„œì˜ íŠ¹ì§•

### 1. ì™„ì „í•œ í•¨ìˆ˜ ì‹œê·¸ë‹ˆì²˜
```python
# âŒ ê¸°ì¡´ ë°©ì‹
def upload_image(job_id, file):
    # ì´ë¯¸ì§€ ì—…ë¡œë“œ ë¡œì§
    pass

# âœ… ìŠˆë„ì½”ë“œ ì£¼ë„ ë°©ì‹
def upload_image(
    self,
    job_id: str,
    file_data: bytes,
    filename: str,
    content_type: str,
    crop_data_str: str
) -> dict:
    """
    ì´ë¯¸ì§€ ì—…ë¡œë“œ ë©”ì¸ ë¡œì§
    
    ì²˜ë¦¬ íë¦„:
    1. Job ì¡°íšŒ ë° ìƒíƒœ í™•ì¸
    2. ì´ë¯¸ì§€ ê²€ì¦
    3. crop_data íŒŒì‹±
    4. S3 ì—…ë¡œë“œ
    5. JobFile ë ˆì½”ë“œ ìƒì„±
    6. Job ìƒíƒœ ì—…ë°ì´íŠ¸ (generating)
    7. ì‘ë‹µ ë°˜í™˜
    
    Args:
        job_id (str): Job ID
        file_data (bytes): ì´ë¯¸ì§€ íŒŒì¼ ë°ì´í„°
        filename (str): íŒŒì¼ëª…
        content_type (str): Content-Type
        crop_data_str (str): í¬ë¡­ ë°ì´í„° JSON ë¬¸ìžì—´
        
    Returns:
        dict: {
            "file_id": str,
            "s3_key": str,
            "message": str
        }
        
    Raises:
        AppException: ê°ì¢… ê²€ì¦ ì‹¤íŒ¨ ë˜ëŠ” ì—…ë¡œë“œ ì‹¤íŒ¨ ì‹œ
    """
```

### 2. ë‹¨ê³„ë³„ ìƒì„¸ ë¡œì§
```python
# âŒ ê¸°ì¡´ ë°©ì‹
# 1. Job ì¡°íšŒ
# 2. ì´ë¯¸ì§€ ê²€ì¦
# 3. S3 ì—…ë¡œë“œ

# âœ… ìŠˆë„ì½”ë“œ ì£¼ë„ ë°©ì‹
# ===== Step 1: Job ì¡°íšŒ ë° ìƒíƒœ í™•ì¸ =====
job = self.db.query(Job).filter(Job.id == job_id).first()

if not job:
    logger.error(f"[ImageService] Job not found: {job_id}")
    raise AppException(
        status_code=404,
        error_code="E-IMG-001",
        message="Job not found"
    )

if job.status != JobStatus.PENDING_UPLOAD:
    logger.error(f"[ImageService] Invalid job status: {job.status}")
    raise AppException(
        status_code=400,
        error_code="E-IMG-002",
        message=f"Invalid job status: {job.status.value}"
    )

logger.info(f"[ImageService] Job found: {job_id}, status={job.status.value}")
```

### 3. ëª¨ë“  ì—ëŸ¬ ì¼€ì´ìŠ¤ ëª…ì‹œ
```python
# âœ… ìŠˆë„ì½”ë“œ ì£¼ë„ ë°©ì‹
# íŒŒì¼ í¬ê¸° ê²€ì¦
if file_size > cls.MAX_SIZE:
    return False, f"File size exceeds {cls.MAX_SIZE // (1024*1024)}MB", {}

if file_size < cls.MIN_SIZE:
    return False, f"File size is too small (minimum {cls.MIN_SIZE // 1024}KB)", {}

# Content-Type ê²€ì¦
if content_type not in cls.ALLOWED_CONTENT_TYPES:
    return False, "Only JPEG and PNG files are allowed", {}

# íŒŒì¼ í™•ìž¥ìž ê²€ì¦
file_ext = filename.lower().split('.')[-1] if '.' in filename else ''
if f".{file_ext}" not in cls.ALLOWED_EXTENSIONS:
    return False, "Invalid file extension", {}
```

### 4. êµ¬ì²´ì ì¸ í…ŒìŠ¤íŠ¸ ì‹œë‚˜ë¦¬ì˜¤
```bash
# âœ… ìŠˆë„ì½”ë“œ ì£¼ë„ ë°©ì‹

### í…ŒìŠ¤íŠ¸ 1: ì •ìƒ ì¼€ì´ìŠ¤
curl -X POST http://localhost:8000/api/v1/uploads/550e8400-e29b-41d4-a716-446655440000 \
  -F "file=@test_image.jpg" \
  -F 'crop_data={"x": 100, "y": 50, "width": 300, "height": 400}'

**ì˜ˆìƒ ì‘ë‹µ (200):**
{
  "success": true,
  "data": {
    "file_id": "file-uuid-123",
    "s3_key": "jobs/.../original/file-uuid-123.jpg",
    "message": "Image uploaded successfully. AI generation started."
  }
}

### í…ŒìŠ¤íŠ¸ 2: íŒŒì¼ í¬ê¸° ì´ˆê³¼
curl -X POST http://localhost:8000/api/v1/uploads/550e8400-e29b-41d4-a716-446655440000 \
  -F "file=@large_image.jpg" \
  -F 'crop_data={"x": 0, "y": 0, "width": 300, "height": 400}'

**ì˜ˆìƒ ì‘ë‹µ (400):**
{
  "success": false,
  "error": {
    "code": "E-IMG-005",
    "message": "File size exceeds 10MB"
  }
}
```

---

## ðŸ“š ìž‘ì„±ëœ ì˜ˆì‹œ ë¬¸ì„œ

### 1. ê²°ì œ ì´ˆê¸°í™” API
**íŒŒì¼:** `docs/implementation/03-payment/02-payment-initialize-DETAILED.md`

**í¬í•¨ ë‚´ìš©:**
- âœ… ì™„ì „í•œ Pydantic ìŠ¤í‚¤ë§ˆ (validator í¬í•¨)
- âœ… PaymentService í´ëž˜ìŠ¤ ì „ì²´ êµ¬í˜„
- âœ… merchant_uid ìƒì„± ë¡œì§ (FMR_YYYYMMDD_HHMMSS_RANDOM6)
- âœ… API ë¼ìš°í„° ì „ì²´ êµ¬í˜„
- âœ… 4ê°€ì§€ í…ŒìŠ¤íŠ¸ ì‹œë‚˜ë¦¬ì˜¤ (ì •ìƒ, í•˜ì´í”ˆ í¬í•¨, 011 ì‹œìž‘, ê¸¸ì´ ì˜¤ë¥˜)
- âœ… DB ë³€ê²½ì‚¬í•­ SQL
- âœ… ì™„ì „í•œ ì²´í¬ë¦¬ìŠ¤íŠ¸

### 2. ì´ë¯¸ì§€ ì—…ë¡œë“œ API
**íŒŒì¼:** `docs/implementation/04-image-upload/03-upload-api-DETAILED.md`

**í¬í•¨ ë‚´ìš©:**
- âœ… ImageValidator í´ëž˜ìŠ¤ (5ë‹¨ê³„ ê²€ì¦)
- âœ… S3Service í´ëž˜ìŠ¤ (ì—…ë¡œë“œ, í‚¤ ìƒì„±)
- âœ… ImageService í´ëž˜ìŠ¤ (7ë‹¨ê³„ ì²˜ë¦¬ íë¦„)
- âœ… API ë¼ìš°í„° (Background Task í¬í•¨)
- âœ… 2ê°€ì§€ í…ŒìŠ¤íŠ¸ ì‹œë‚˜ë¦¬ì˜¤
- âœ… ì™„ì „í•œ ì²´í¬ë¦¬ìŠ¤íŠ¸

---

## ðŸš€ ì‚¬ìš© ë°©ë²•

### ê°œë°œìžê°€ ë¬¸ì„œë¥¼ ë³´ê³  ì½”ë”©í•˜ëŠ” ë°©ë²•

1. **ë¬¸ì„œ ì½ê¸°**
   - í•´ë‹¹ ê¸°ëŠ¥ì˜ `-DETAILED.md` íŒŒì¼ ì—´ê¸°
   - API ìŠ¤íŽ™, ì—ëŸ¬ ì½”ë“œ í™•ì¸

2. **íŒŒì¼ ìƒì„±**
   - ë¬¸ì„œì— ëª…ì‹œëœ íŒŒì¼ ê²½ë¡œëŒ€ë¡œ ìƒì„±
   - ì˜ˆ: `app/services/payment_service.py`

3. **ì½”ë“œ ë³µì‚¬ & ìˆ˜ì •**
   - ë¬¸ì„œì˜ ìŠˆë„ì½”ë“œë¥¼ ë³µì‚¬
   - ì‹¤ì œ Python ë¬¸ë²•ì— ë§žê²Œ ë¯¸ì„¸ ì¡°ì •
   - ë¡œê¹…, ì—ëŸ¬ ì²˜ë¦¬ëŠ” ì´ë¯¸ í¬í•¨ë˜ì–´ ìžˆìŒ

4. **í…ŒìŠ¤íŠ¸**
   - ë¬¸ì„œì˜ í…ŒìŠ¤íŠ¸ ì‹œë‚˜ë¦¬ì˜¤ ê·¸ëŒ€ë¡œ ì‹¤í–‰
   - curl ëª…ë ¹ì–´ ë³µì‚¬í•´ì„œ ì‹¤í–‰

5. **ì²´í¬ë¦¬ìŠ¤íŠ¸ í™•ì¸**
   - ë¬¸ì„œ í•˜ë‹¨ì˜ ì²´í¬ë¦¬ìŠ¤íŠ¸ë¡œ ì™„ë£Œ í™•ì¸

---

## ðŸ’¡ ìž¥ì 

### 1. ê°œë°œ ì†ë„ í–¥ìƒ
- ê³ ë¯¼ ì‹œê°„ ìµœì†Œí™” (ì´ë¯¸ ëª¨ë“  ë¡œì§ì´ ëª…ì‹œë¨)
- ë³µì‚¬-ë¶™ì—¬ë„£ê¸° í›„ ë¯¸ì„¸ ì¡°ì •ë§Œ í•˜ë©´ ë¨

### 2. ì¼ê´€ì„± ë³´ìž¥
- ëª¨ë“  ê°œë°œìžê°€ ê°™ì€ íŒ¨í„´ ì‚¬ìš©
- ë³€ìˆ˜ëª…, ì—ëŸ¬ ì½”ë“œ, ë¡œê¹… í˜•ì‹ í†µì¼

### 3. ë²„ê·¸ ê°ì†Œ
- ëª¨ë“  ì—£ì§€ ì¼€ì´ìŠ¤ê°€ ë¬¸ì„œì— ëª…ì‹œë¨
- ì—ëŸ¬ ì²˜ë¦¬ ëˆ„ë½ ë°©ì§€

### 4. í…ŒìŠ¤íŠ¸ ìš©ì´
- êµ¬ì²´ì ì¸ í…ŒìŠ¤íŠ¸ ì‹œë‚˜ë¦¬ì˜¤ ì œê³µ
- ì˜ˆìƒ ì‘ë‹µê¹Œì§€ ëª…ì‹œ

### 5. ì˜¨ë³´ë”© ê°„ì†Œí™”
- ì‹ ìž… ê°œë°œìžë„ ë¬¸ì„œë§Œ ë³´ê³  ê°œë°œ ê°€ëŠ¥
- ì½”ë“œ ë¦¬ë·° ì‹œê°„ ë‹¨ì¶•

---

## ðŸ“Š ë‹¤ìŒ ë‹¨ê³„

### ì˜µì…˜ 1: ë‚˜ë¨¸ì§€ ë¬¸ì„œë„ ê°™ì€ ë°©ì‹ìœ¼ë¡œ ìž‘ì„±
**ì˜ˆìƒ ì†Œìš” ì‹œê°„:** 4-6ì‹œê°„
**ìž‘ì„±í•  ë¬¸ì„œ:** 34ê°œ (í˜„ìž¬ 2ê°œ ì™„ë£Œ)

**ìš°ì„ ìˆœìœ„:**
1. ê²°ì œ Webhook (03-payment/03-payment-webhook-DETAILED.md)
2. AI ì´ë¯¸ì§€ ìƒì„± (05-ai-generation/02-image-generation-DETAILED.md)
3. ë¦¬í¬íŠ¸ ìƒì„± (06-report-generation/04-report-creation-DETAILED.md)
4. ì „í™”ë²ˆí˜¸ ì¸ì¦ (08-result-view/01-phone-verification-DETAILED.md)
5. 24ì‹œê°„ ìžë™ ì‚­ì œ (09-security/02-auto-deletion-DETAILED.md)

### ì˜µì…˜ 2: í•µì‹¬ ê¸°ëŠ¥ë§Œ ìƒì„¸ ë¬¸ì„œ ìž‘ì„±
**ì˜ˆìƒ ì†Œìš” ì‹œê°„:** 2-3ì‹œê°„
**ìž‘ì„±í•  ë¬¸ì„œ:** 10ê°œ (í•µì‹¬ ê¸°ëŠ¥ë§Œ)

### ì˜µì…˜ 3: ë°”ë¡œ ê°œë°œ ì‹œìž‘
**ë°©ë²•:** í˜„ìž¬ 2ê°œ ë¬¸ì„œë¥¼ ì°¸ê³ í•˜ì—¬ ê°œë°œ ì‹œìž‘
**í•„ìš” ì‹œ:** ì¶”ê°€ ë¬¸ì„œ ìš”ì²­

---

## â“ ëŒ€í‘œë‹˜ê»˜ ì§ˆë¬¸

1. **ì´ ë°©ì‹ì´ ë§ˆìŒì— ë“œì‹œë‚˜ìš”?**
   - ì¶©ë¶„ížˆ ìƒì„¸í•œê°€ìš”?
   - ë” ì¶”ê°€í•  ë‚´ìš©ì´ ìžˆë‚˜ìš”?

2. **ë‚˜ë¨¸ì§€ 34ê°œ ë¬¸ì„œë„ ì´ ë°©ì‹ìœ¼ë¡œ ìž‘ì„±í• ê¹Œìš”?**
   - ì „ì²´ ìž‘ì„± (4-6ì‹œê°„)
   - í•µì‹¬ë§Œ ìž‘ì„± (2-3ì‹œê°„)
   - í•„ìš”í•  ë•Œë§ˆë‹¤ ìž‘ì„±

3. **ë°”ë¡œ ê°œë°œì„ ì‹œìž‘í•˜ì‹œê² ìŠµë‹ˆê¹Œ?**
   - í˜„ìž¬ 2ê°œ ë¬¸ì„œë¡œ ì¶©ë¶„í•œê°€ìš”?
   - ì–´ë–¤ ê¸°ëŠ¥ë¶€í„° ê°œë°œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?

---

## ðŸ“ ì°¸ê³ 

ì´ ë°©ì‹ì€ ë‹¤ìŒê³¼ ê°™ì€ ê°œë°œ ë°©ë²•ë¡ ì„ ë”°ë¦…ë‹ˆë‹¤:
- **Pseudocode-Driven Development**: ì½”ë“œ ìž‘ì„± ì „ ìŠˆë„ì½”ë“œë¡œ ì„¤ê³„
- **Documentation-First Development**: ë¬¸ì„œë¥¼ ë¨¼ì € ìž‘ì„±í•˜ê³  ì½”ë“œëŠ” ë‚˜ì¤‘ì—
- **Test-Driven Development**: í…ŒìŠ¤íŠ¸ ì‹œë‚˜ë¦¬ì˜¤ë¥¼ ë¨¼ì € ì •ì˜

ê²°ê³¼ì ìœ¼ë¡œ **ê°œë°œ ì†ë„ëŠ” ë¹ ë¥´ê³ , ë²„ê·¸ëŠ” ì ê³ , ìœ ì§€ë³´ìˆ˜ëŠ” ì‰¬ìš´** ì½”ë“œê°€ íƒ„ìƒí•©ë‹ˆë‹¤.

