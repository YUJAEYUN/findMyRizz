# Find My Rizz - 상세 PRD (Product Requirements Document)

## 문서 정보

- **버전**: 1.0
- **작성일**: 2024-01-01
- **대상**: MVP (Minimum Viable Product)
- **목표**: 2개월 내 수익 창출 가능한 서비스 런칭

---

## 목차

1. [제품 개요](#1-제품-개요)
2. [핵심 기능 상세](#2-핵심-기능-상세)
3. [사용자 스토리](#3-사용자-스토리)
4. [기술 요구사항](#4-기술-요구사항)
5. [비기능 요구사항](#5-비기능-요구사항)
6. [성공 지표](#6-성공-지표)

---

## 1. 제품 개요

### 1.1 제품 비전

"Find My Rizz"는 AI를 활용하여 사용자의 잠재적 매력을 시각화하고, 실현 가능한 자기관리 로드맵을 제공하는 서비스입니다.

### 1.2 핵심 가치 제안

- **현실성**: 과장 없는 자연스러운 개선 이미지
- **동기부여**: 명확한 목표 이미지 제공
- **간편성**: 회원가입 없이 결제 → 전화번호 입력 → 이미지 업로드 → 결과 수신

### 1.3 타겟 사용자

- **1차 타겟**: 20-30대 자기관리에 관심 있는 남녀
- **2차 타겟**: 데이팅 앱 사용자, 프로필 사진 개선 니즈

### 1.4 비즈니스 모델

- **수익 모델**: 1회 결제 (9,900원)
- **목표**: 월 1,000건 → 월 990만원 매출

---

## 2. 핵심 기능 상세

### 2.1 결제 시스템

#### 2.1.1 기능 개요

- 포트원(PortOne) 연동 결제
- 금액: 9,900원 (부가세 포함)
- 지원 결제수단: 카드, 계좌이체, 간편결제

#### 2.1.2 상세 요구사항

**FR-PAY-001: 결제 초기화**

- 사용자가 "지금 바로 나의 리즈 알아보기" 버튼 클릭 시 결제창 호출
- 결제 전 Job 생성 (status: pending_payment)
- merchant*uid 생성 규칙: `FMR*{YYYYMMDD}_{HHMMSS}_{RANDOM6}`
- 전화번호는 결제 성공 후 입력받음

**FR-PAY-002: 결제 검증**

- PortOne Webhook 수신
- PortOne API로 결제 정보 재검증
- 금액 일치 확인 (9,900원)
- 검증 성공 시 Job 상태 업데이트 (pending_phone)

**FR-PAY-003: 전화번호 등록**

- 결제 성공 후 전화번호 입력 페이지 표시
- 전화번호 형식 검증 (010-XXXX-XXXX)
- Job에 전화번호 저장
- 저장 성공 시 Job 상태 업데이트 (pending_upload)

**FR-PAY-004: 결제 실패 처리**

- 결제 실패 시 payment_failures 테이블에 로그 저장
- 사용자에게 실패 사유 표시
- 랜딩 페이지로 리다이렉트

**FR-PAY-005: 중복 결제 방지**

- merchant_uid 중복 체크
- 동일 전화번호로 24시간 내 중복 결제 시 경고 (전화번호 등록 후 체크)

#### 2.1.3 예외 처리

- 결제 금액 불일치: 에러 반환 및 로그 저장
- Webhook 검증 실패: 관리자 알림
- 네트워크 오류: 3회 재시도 후 실패 처리

#### 2.1.4 성공 기준

- 결제 성공률 > 95%
- 결제 검증 시간 < 3초
- 중복 결제 발생률 < 0.1%

---

### 2.2 이미지 업로드 및 처리

#### 2.2.1 기능 개요

- 사용자 얼굴 사진 업로드
- 3:4 비율 크롭 기능
- 이미지 검증 및 S3 저장

#### 2.2.2 상세 요구사항

**FR-IMG-001: 사진 가이드 제공**

- 좋은 예시 3개 표시:
  1. 정면 얼굴
  2. 밝은 조명
  3. 선명한 화질
- 나쁜 예시 3개 표시:
  1. 측면 얼굴
  2. 어두운 조명
  3. 선글라스/마스크 착용

**FR-IMG-002: 이미지 크롭**

- 프론트엔드에서 Canvas API 사용
- 3:4 비율 강제
- 크롭 영역 미리보기 제공
- 크롭 데이터 저장 (x, y, width, height)

**FR-IMG-003: 이미지 검증 및 변환**

- 파일 형식: JPEG, PNG, WEBP, HEIC 등 모든 이미지 형식 허용
- **자동 PNG 변환**: 업로드된 이미지가 PNG가 아닌 경우 자동으로 PNG로 변환
  - Pillow 라이브러리 사용
  - 원본 품질 유지
  - 변환 후 파일명: `{uuid}.png`
- 파일 크기: 최대 10MB (변환 전 기준)
- 최소 해상도: 512x512
- (선택사항) 얼굴 감지 API로 얼굴 존재 확인

**FR-IMG-004: S3 업로드**

- 파일명: `{job_id}/original/{uuid}.png` (PNG로 통일)
- 메타데이터 저장: 파일 크기, MIME 타입 (image/png), 크롭 데이터, 원본 형식
- job_files 테이블에 레코드 생성

**FR-IMG-005: Job 상태 업데이트**

- 업로드 성공 시 status: processing
- Background Task 시작

#### 2.2.3 예외 처리

- 지원하지 않는 파일 형식: 에러 메시지 표시 (이미지 파일이 아닌 경우)
- PNG 변환 실패: 에러 로그 저장 및 사용자에게 안내
- 파일 크기 초과: 압축 안내 또는 거부
- 얼굴 미감지: 경고 표시 후 계속 진행 (선택사항)
- S3 업로드 실패: 3회 재시도

#### 2.2.4 성공 기준

- 업로드 성공률 > 98%
- 업로드 시간 < 5초 (10MB 기준)
- 얼굴 감지 정확도 > 90% (선택사항)

---

### 2.3 AI 이미지 생성

#### 2.3.1 기능 개요

- Replicate AI 이미지 생성 API 사용
- 3장의 개선된 이미지 생성
- AI 이미지 생성 프롬프트 사용

#### 2.3.2 상세 요구사항

**FR-AI-001: 이미지 생성 시작**

- Background Task로 실행
- S3에서 원본 이미지 다운로드
- Replicate API 호출 (3회, 다른 seed)

**FR-AI-002: 프롬프트 구성**

- AI 이미지 생성 프롬프트 내용 사용
- 원본 이미지를 input으로 전달
- 파라미터:
  - num_outputs: 1 (3회 반복)
  - guidance_scale: 7.5
  - num_inference_steps: 50
  - seed: random (각기 다른 값)

**FR-AI-003: 생성 결과 저장**

- 생성된 이미지 S3 업로드
- 파일명: `{job_id}/generated/{order}_{uuid}.jpg`
- job_files 테이블에 레코드 생성 (display_order: 1, 2, 3)

**FR-AI-004: 진행 상태 업데이트**

- 생성 중: Job 상태 유지 (processing)
- 생성 완료: 리포트 생성 단계로 진행

#### 2.3.3 예외 처리

- API 호출 실패: 지수 백오프로 3회 재시도
- 생성 시간 초과 (5분): 실패 처리
- 부적절한 콘텐츠 감지: 재생성 또는 실패 처리
- 3장 중 일부 실패: 성공한 이미지만 저장 후 계속 진행

#### 2.3.4 성공 기준

- 생성 성공률 > 95%
- 평균 생성 시간 < 3분 (3장 기준)
- 사용자 만족도 > 4.0/5.0

---

### 2.4 리포트 생성 (LangGraph 기반)

#### 2.4.1 기능 개요

- **LangGraph 워크플로우**: 확장 가능한 AI 파이프라인 구조
- OpenAI GPT-4o 사용
- 원본 vs 생성 이미지 분석
- 맞춤형 관리법 추천

#### 2.4.1-1 LangGraph 아키텍처

**워크플로우 구조:**

```
[이미지 분석] → [개선 영역 식별] → [관리법 매칭] → [리포트 생성]
     ↓              ↓                  ↓               ↓
  GPT-4o Vision   구조화 파싱      KB 검색         최종 포맷팅
```

**노드 정의:**

1. **ImageAnalysisNode**: GPT-4o Vision으로 이미지 비교 분석
2. **ImprovementExtractionNode**: 분석 결과에서 개선 영역 추출
3. **RecommendationMatchingNode**: Knowledge Base에서 관리법 매칭
4. **ReportFormattingNode**: 최종 리포트 구조화

**상태 관리:**

- 각 노드 간 상태 전달
- 에러 발생 시 이전 단계로 복구 가능
- 중간 결과 저장으로 재시도 최적화

#### 2.4.2 상세 요구사항

**FR-RPT-001: 이미지 분석 (ImageAnalysisNode)**

- GPT-4o Vision API 사용
- 원본 이미지와 생성된 이미지 3장 비교
- LangGraph State에 분석 결과 저장
- 개선된 영역 식별:
  - 피부 (톤, 질감, 광채)
  - 얼굴 윤곽 (턱선, V라인)
  - 표정 (눈빛, 인상)
  - 기타 (헤어, 눈썹 등)

**FR-RPT-002: 프롬프트 구성**

```
당신은 뷰티 및 자기관리 전문가입니다.
첨부된 원본 이미지와 AI가 생성한 3장의 개선 이미지를 비교 분석하세요.

분석 기준:
1. 피부: 톤, 질감, 광채, 잡티
2. 얼굴 윤곽: 턱선, V라인, 볼륨
3. 표정: 눈빛, 인상
4. 기타: 헤어, 눈썹, 전반적 인상

출력 형식 (JSON):
{
  "summary": "전반적인 개선 방향 요약 (2-3문장)",
  "improvements": [
    {
      "area": "개선 영역 (예: 피부 관리)",
      "description": "구체적 개선 내용",
      "priority": "high/medium/low"
    }
  ]
}
```

**FR-RPT-003: 관리법 매칭 (RecommendationMatchingNode)**

- ImprovementExtractionNode의 출력 기반
- knowledge_base에서 관련 항목 검색
- LangGraph를 통한 체계적 매칭 로직
- 우선순위별 정렬:
  1. Self-care (홈케어)
  2. Procedure (시술)
- job_recommendations 테이블에 저장

**FR-RPT-004: 리포트 구조화 (ReportFormattingNode)**

- LangGraph 최종 노드에서 리포트 포맷팅
- ai_analysis_text 필드에 JSON 저장
- 프론트엔드에서 렌더링용 데이터 제공
- 예상 기간 및 비용 계산

**FR-RPT-005: LangGraph 에러 처리**

- 각 노드별 에러 핸들링
- 실패 시 이전 노드로 복구 시도
- 최대 재시도 횟수: 3회
- 전체 워크플로우 실패 시 기본 템플릿 사용

#### 2.4.3 예외 처리

- GPT-4o API 실패: 3회 재시도
- 분석 결과 없음: 기본 템플릿 사용
- 관리법 매칭 실패: 일반적인 추천 제공

#### 2.4.4 성공 기준

- 리포트 생성 성공률 > 98%
- 평균 생성 시간 < 30초
- 관리법 매칭 정확도 > 85%

---

### 2.5 SMS 발송

#### 2.5.1 기능 개요

- CoolSMS API 사용
- 결과 URL 발송
- 24시간 만료 안내

#### 2.5.2 상세 요구사항

**FR-SMS-001: SMS 발송 트리거**

- AI 생성 및 리포트 생성 완료 후
- Job 상태: completed
- 결과 URL 생성: `https://findmyrizz.com/result/{job_id}`

**FR-SMS-002: 메시지 템플릿**

```
[Find My Rizz]
나의 리즈 사진이 완성되었습니다!
아래 링크에서 24시간 내에 확인하세요.
{result_url}

※ 24시간 후 자동 삭제됩니다.
```

**FR-SMS-003: 발송 로그**

- sms_logs 테이블에 저장
- CoolSMS group_id, message_id 저장
- 발송 상태 추적

**FR-SMS-004: 재시도 로직**

- 발송 실패 시 5분 후 재시도
- 최대 3회 재시도
- 3회 실패 시 관리자 알림

#### 2.5.3 예외 처리

- 잘못된 전화번호: 에러 로그 저장
- API 호출 실패: 재시도
- 발송 실패: 관리자 알림

#### 2.5.4 성공 기준

- 발송 성공률 > 98%
- 발송 시간 < 10초
- 사용자 수신률 > 95%

---

### 2.6 결과 조회

#### 2.6.1 기능 개요

- 전화번호 인증
- 이미지 3장 + 리포트 표시
- 다운로드 기능

#### 2.6.2 상세 요구사항

**FR-RES-001: 전화번호 인증**

- SMS 링크 클릭 시 인증 페이지 표시
- 전화번호 입력 (하이픈 자동 삽입)
- Job의 user_phone_number와 일치 확인
- JWT 토큰 발급 (유효기간: 1시간)

**FR-RES-002: 인증 실패 처리**

- 3회 실패 시 IP 기반 1시간 차단
- phone_verification_attempts 테이블에 로그 저장
- 실패 사유 표시

**FR-RES-003: 결과 페이지 표시**

- 이미지 3장 표시 (Presigned URL 사용)
- 리포트 표시:
  - 전반적 요약
  - 영역별 개선 사항
  - 추천 관리법 (Self-care + Procedure)
  - 예상 기간 및 비용
- 만료 시간 카운트다운 표시

**FR-RES-004: 다운로드 기능**

- "내 사진 모두 다운로드" 버튼
- ZIP 파일 생성 (이미지 3장)
- 파일명: `my_rizz_images_{YYYYMMDD}.zip`

#### 2.6.3 예외 처리

- Job 만료 (24시간 경과): 410 Gone 에러
- 인증 실패: 401 Unauthorized
- 파일 없음: 500 에러 및 관리자 알림

#### 2.6.4 성공 기준

- 인증 성공률 > 95%
- 페이지 로딩 시간 < 2초
- 다운로드 성공률 > 99%

---

### 2.7 만족도 조사

#### 2.7.1 기능 개요

- 선택적 설문 조사
- 서비스 개선 데이터 수집

#### 2.7.2 상세 요구사항

**FR-SUR-001: 설문 항목**

1. 서비스 이용 목적 (단일 선택)
   - 자기관리 동기부여
   - 데이팅 프로필 개선
   - 호기심
   - 기타
2. 유입 경로 (단일 선택)
   - 인스타그램 광고
   - 페이스북 광고
   - 지인 추천
   - 검색
   - 기타
3. 만족도 (5점 척도)
4. 추천 의향 (예/아니오)
5. 재이용 의향 (예/아니오)
6. 자유 피드백 (선택사항)
7. 리뷰 (선택사항, 최대 250자)

**FR-SUR-002: 데이터 저장**

- survey_responses 테이블에 JSONB 형식 저장
- 익명 처리 (개인정보 제외)

**FR-SUR-003: 제출 완료**

- 감사 메시지 표시
- 추가 혜택 안내 (향후 확장)

#### 2.7.3 성공 기준

- 설문 참여율 > 30%
- 평균 만족도 > 4.0/5.0

---

## 3. 사용자 스토리

### 3.1 핵심 사용자 스토리

**US-001: 결제 및 시작**

```
As a 사용자
I want to 간편하게 결제하고 서비스를 시작하고 싶다
So that 복잡한 회원가입 없이 빠르게 결과를 받을 수 있다
```

**US-002: 이미지 업로드**

```
As a 사용자
I want to 가이드를 보고 최적의 사진을 업로드하고 싶다
So that 정확한 분석 결과를 받을 수 있다
```

**US-003: 결과 확인**

```
As a 사용자
I want to SMS로 받은 링크에서 결과를 확인하고 싶다
So that 언제 어디서나 편리하게 결과를 볼 수 있다
```

**US-004: 관리법 확인**

```
As a 사용자
I want to 구체적인 관리법과 비용을 알고 싶다
So that 실제로 실행 가능한 계획을 세울 수 있다
```

---

## 4. 기술 요구사항

### 4.1 성능 요구사항

- API 응답 시간: < 500ms (이미지 생성 제외)
- AI 이미지 생성 시간: < 3분 (3장)
- 리포트 생성 시간: < 30초
- 동시 접속자: 100명 지원

### 4.2 보안 요구사항

- HTTPS 필수
- 전화번호 해싱 저장 (선택사항)
- S3 Presigned URL (유효기간: 1시간)
- SQL Injection 방어
- XSS 방어

### 4.3 확장성 요구사항

- 수평 확장 가능한 아키텍처
- Stateless API 설계
- Background Task 분리
- **LangGraph 기반 AI 워크플로우**:
  - 노드 단위 독립적 확장
  - 새로운 AI 기능 추가 시 기존 코드 영향 최소화
  - 상태 관리 및 에러 복구 체계화

---

## 5. 비기능 요구사항

### 5.1 가용성

- 서비스 가동률: > 99%
- 계획된 유지보수: 주 1회, 새벽 시간대

### 5.2 모니터링

- 실시간 에러 추적 (Sentry)
- 성능 모니터링 (CloudWatch)
- 비즈니스 메트릭 대시보드

### 5.3 백업

- 데이터베이스 일일 백업
- S3 버전 관리 활성화

---

## 6. 성공 지표

### 6.1 비즈니스 지표

- 월 거래 건수: > 1,000건
- 결제 전환율: > 10%
- 평균 만족도: > 4.0/5.0
- 재구매율: > 20% (향후 확장 시)

### 6.2 기술 지표

- 결제 성공률: > 95%
- AI 생성 성공률: > 95%
- SMS 발송 성공률: > 98%
- API 에러율: < 1%

### 6.3 사용자 경험 지표

- 전체 프로세스 완료율: > 80%
- 평균 완료 시간: < 10분
- 결과 조회율: > 90%
