# 라이브러리 선정 이유

## 1. 웹 프레임워크

### FastAPI 0.104+
**선정 이유:**
- ✅ **비동기 지원**: `async/await`로 높은 동시성 처리
- ✅ **자동 문서화**: OpenAPI/Swagger 자동 생성
- ✅ **타입 안정성**: Pydantic 기반 자동 검증
- ✅ **성능**: Starlette 기반으로 Node.js 수준 성능
- ✅ **생산성**: 코드 작성량 40% 감소

**대안 비교:**
- Django: 동기 기반, 무거움
- Flask: 비동기 지원 부족
- FastAPI: ✅ **선택**

---

## 2. 데이터베이스

### PostgreSQL 15+
**선정 이유:**
- ✅ **JSONB 지원**: `survey_data`, `improvement_areas` 등 유연한 데이터 저장
- ✅ **ACID 보장**: 결제 데이터 무결성
- ✅ **성능**: 인덱스 최적화 (HASH, GIN)
- ✅ **확장성**: 수평 확장 가능 (Citus)

### SQLAlchemy 2.0+
**선정 이유:**
- ✅ **비동기 ORM**: `asyncpg` 드라이버 지원
- ✅ **타입 안정성**: 2.0부터 타입 힌트 강화
- ✅ **마이그레이션**: Alembic 통합

**대안 비교:**
- Django ORM: FastAPI와 통합 어려움
- Tortoise ORM: 생태계 작음
- SQLAlchemy: ✅ **선택**

---

## 3. 백그라운드 작업

### Celery 5.3+
**선정 이유:**
- ✅ **분산 처리**: AI 생성 작업 병렬 처리
- ✅ **재시도 로직**: 실패 시 자동 재시도
- ✅ **스케줄링**: Celery Beat로 24시간 데이터 삭제
- ✅ **모니터링**: Flower 대시보드

### Redis 7.0+
**선정 이유:**
- ✅ **메시지 브로커**: Celery 작업 큐
- ✅ **캐싱**: Rate Limiting, 세션 저장
- ✅ **성능**: 인메모리 DB로 빠른 응답

**대안 비교:**
- RabbitMQ: 설정 복잡, 오버킬
- Redis: ✅ **선택** (간단하고 빠름)

---

## 4. 결제

### PortOne V2
**선정 이유:**
- ✅ **통합 SDK**: 여러 PG사 통합 관리
- ✅ **웰컴페이먼츠 지원**: 계약된 PG사
- ✅ **Webhook 지원**: 결제 검증 자동화
- ✅ **한국 시장 최적화**: 국내 결제 수단 완벽 지원

**대안 비교:**
- 직접 PG 연동: 개발 시간 증가
- PortOne V1: 구버전, 기능 제한
- PortOne V2: ✅ **선택**

---

## 5. AI 서비스

### Replicate (SeeDream4)
**선정 이유:**
- ✅ **SeeDream4 모델**: 현실적인 얼굴 개선 특화
- ✅ **API 간편성**: REST API로 쉬운 통합
- ✅ **Webhook 지원**: 비동기 처리 가능
- ✅ **비용 효율**: 사용량 기반 과금

**대안 비교:**
- Stable Diffusion 직접 호스팅: 인프라 비용 높음
- Midjourney: API 없음
- Replicate: ✅ **선택**

### OpenAI GPT-4o
**선정 이유:**
- ✅ **Vision 지원**: 이미지 분석 가능
- ✅ **JSON 모드**: 구조화된 출력
- ✅ **한국어 성능**: 자연스러운 리포트 생성
- ✅ **안정성**: 99.9% 가동률

**대안 비교:**
- Claude 3.5 Sonnet: Vision 지원 부족
- Gemini Pro: 한국어 성능 낮음
- GPT-4o: ✅ **선택**

---

## 6. 파일 저장

### AWS S3
**선정 이유:**
- ✅ **Presigned URL**: 보안 강화
- ✅ **내구성**: 99.999999999% (11 nines)
- ✅ **확장성**: 무제한 저장
- ✅ **비용**: 저렴한 스토리지 비용

### boto3
**선정 이유:**
- ✅ **공식 SDK**: AWS 공식 Python 라이브러리
- ✅ **완전한 기능**: S3 모든 기능 지원
- ✅ **문서화**: 풍부한 예제

---

## 7. SMS 발송

### CoolSMS
**선정 이유:**
- ✅ **국내 최대**: 안정적인 발송률
- ✅ **API 간편성**: REST API 제공
- ✅ **가격**: 건당 15원 (저렴)
- ✅ **대량 발송**: 그룹 발송 지원

**대안 비교:**
- Twilio: 해외 서비스, 비쌈
- 알리고: 기능 제한적
- CoolSMS: ✅ **선택**

---

## 8. 보안 및 인증

### python-jose (JWT)
**선정 이유:**
- ✅ **표준 준수**: RFC 7519 JWT 표준
- ✅ **암호화**: RSA, HMAC 지원
- ✅ **FastAPI 통합**: 공식 권장 라이브러리

### slowapi (Rate Limiting)
**선정 이유:**
- ✅ **FastAPI 전용**: 비동기 지원
- ✅ **유연성**: IP, 사용자별 제한 가능
- ✅ **Redis 통합**: 분산 환경 지원

---

## 9. 이미지 처리

### Pillow 10.1+
**선정 이유:**
- ✅ **포맷 변환**: JPEG/PNG/WEBP/HEIC → PNG
- ✅ **리사이즈**: Vision API 비용 절감
- ✅ **크롭**: 3:4 비율 강제
- ✅ **안정성**: 가장 널리 사용되는 라이브러리

**대안 비교:**
- OpenCV: 오버킬 (너무 무거움)
- imageio: 기능 부족
- Pillow: ✅ **선택**

---

## 10. 전화번호 검증

### phonenumbers
**선정 이유:**
- ✅ **Google 라이브러리**: libphonenumber 포팅
- ✅ **국제 표준**: E.164 형식 지원
- ✅ **검증 정확도**: 99% 이상
- ✅ **한국 번호 지원**: 010, 011 등 모두 지원

---

## 11. 모니터링

### Sentry
**선정 이유:**
- ✅ **실시간 에러 추적**: 즉시 알림
- ✅ **스택 트레이스**: 디버깅 용이
- ✅ **성능 모니터링**: APM 기능
- ✅ **무료 티어**: 월 5,000 이벤트

### structlog
**선정 이유:**
- ✅ **구조화 로깅**: JSON 형식
- ✅ **컨텍스트 바인딩**: 요청 ID 추적
- ✅ **성능**: 빠른 로깅

---

## 12. 테스트

### pytest 7.4+
**선정 이유:**
- ✅ **비동기 지원**: pytest-asyncio
- ✅ **픽스처**: 재사용 가능한 테스트 데이터
- ✅ **커버리지**: pytest-cov 통합
- ✅ **생산성**: 간결한 문법

---

## 13. 코드 품질

### Black (포매터)
**선정 이유:**
- ✅ **일관성**: 팀 전체 코드 스타일 통일
- ✅ **자동화**: pre-commit 훅 통합
- ✅ **논쟁 종료**: "The Uncompromising Code Formatter"

### mypy (타입 체커)
**선정 이유:**
- ✅ **타입 안정성**: 런타임 전 에러 발견
- ✅ **FastAPI 통합**: Pydantic과 완벽 호환
- ✅ **점진적 도입**: 기존 코드에 점진적 적용 가능

---

## 요약

| 카테고리 | 라이브러리 | 핵심 이유 |
|---------|-----------|----------|
| 웹 프레임워크 | FastAPI | 비동기, 자동 문서화, 타입 안정성 |
| 데이터베이스 | PostgreSQL + SQLAlchemy | JSONB, 비동기 ORM |
| 백그라운드 | Celery + Redis | 분산 처리, 스케줄링 |
| 결제 | PortOne V2 | 웰컴페이먼츠 통합 |
| AI | Replicate + OpenAI | SeeDream4, GPT-4o Vision |
| 파일 저장 | AWS S3 + boto3 | Presigned URL, 내구성 |
| SMS | CoolSMS | 국내 최대, 저렴 |
| 보안 | python-jose + slowapi | JWT, Rate Limiting |
| 이미지 처리 | Pillow | 포맷 변환, 리사이즈 |
| 모니터링 | Sentry + structlog | 에러 추적, 구조화 로깅 |
| 테스트 | pytest | 비동기 지원, 픽스처 |
| 코드 품질 | Black + mypy | 포매팅, 타입 체킹 |

---

## 총 예상 비용 (월 1,000건 기준)

| 항목 | 비용 |
|------|------|
| AWS S3 | ~$5 |
| Replicate (SeeDream4) | ~$300 (건당 $0.10 x 3장 x 1,000건) |
| OpenAI (GPT-4o) | ~$50 (건당 $0.05 x 1,000건) |
| CoolSMS | ~$15 (건당 15원 x 1,000건) |
| **총합** | **~$370/월** |

**수익**: 9,900원 x 1,000건 = 9,900,000원/월  
**순이익**: 9,900,000원 - 500,000원 = **9,400,000원/월**

